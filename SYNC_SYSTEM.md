# MangaBuff Distributed Cache System

–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫—ç—à–∞ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è MangaBuff.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Chrome Extension (–º–Ω–æ–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
        ‚Üì‚Üì‚Üì (–æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ)
    API Server (Node.js + Express)
        ‚Üì
    PostgreSQL Database
        ‚Üì‚Üì‚Üì (–ø–æ–ª—É—á–∞—é—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ)
Chrome Extension (–≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### üì¶ Extension (`/sync.js`)
- `syncCacheToServer()` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- `syncCacheFromServer()` ‚Äî –ø–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞
- `compareAndUpdateCache()` ‚Äî —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç timestamps –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç

### üñ•Ô∏è Backend (`/backend/server.js`)
- REST API –¥–ª—è push/pull –æ–ø–µ—Ä–∞—Ü–∏–π
- PostgreSQL –±–∞–∑–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—ç—à–∞
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ timestamps –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ health-check

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1Ô∏è‚É£ Push (–æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
```javascript
// Extension –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
POST /sync/push
{
  "entries": [
    { "key": "owners_123", "count": 100, "timestamp": 1766779000000 },
    { "key": "wishlist_123", "count": 50, "timestamp": 1766778000000 }
  ]
}

// –°–µ—Ä–≤–µ—Ä:
// - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç timestamp —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å—å—é
// - –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π timestamp > —Å–µ—Ä–≤–µ—Ä–Ω—ã–π ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç
// - –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –≤—Å—Ç–∞–≤–ª—è–µ—Ç
```

### 2Ô∏è‚É£ Pull (–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
```javascript
// Extension –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞—Ä—Ç
POST /sync/pull
{
  "cardIds": [123, 124, 125]
}

// –û—Ç–≤–µ—Ç:
{
  "entries": [
    { "key": "owners_123", "count": 100, "timestamp": 1766779000000 },
    ...
  ]
}
```

### 3Ô∏è‚É£ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç extension –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —Å–≤–µ–∂–µ–µ
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ù–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞** ‚Äî –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–∞—Ä—Ç—ã  
‚úÖ **–î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã** ‚Äî timestamp-based sync  
‚úÖ **–≠–∫–æ–Ω–æ–º–Ω–æ** ‚Äî –±–∞—Ç—á–∏–Ω–≥, –ø–µ—Ä–∏–æ–¥ 30 –º–∏–Ω—É—Ç  
‚úÖ **–ü—Ä–∏–≤–∞—Ç–Ω–æ** ‚Äî –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ç–æ–ª—å–∫–æ count + timestamp  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 1 –∏ –Ω–∞ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  

## Quick Start

### Local Development
```bash
# Backend
cd backend
npm install
# –°–æ–∑–¥–∞–π—Ç–µ .env —Å DATABASE_URL
npm run dev

# Extension
npm run build
# –ó–∞–≥—Ä—É–∑–∏—Ç–µ dist/ –≤ Chrome –∫–∞–∫ unpacked extension
```

### Production Deployment

**–í–∞—Ä–∏–∞–Ω—Ç 1: Railway (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
# Push –≤ GitHub
# –ù–∞ railway.app –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
# –ü–æ–ª—É—á–∏—Ç–µ URL: https://your-app.railway.app
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: Supabase + Vercel**
- Supabase –¥–ª—è –ë–î (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)
- Vercel –¥–ª—è serverless functions (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π tier)

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ Extension

–í `config.js`:
```javascript
export const SYNC_SERVER_URL = 'https://your-app.railway.app';
```

–í `manifest.json` –¥–æ–±–∞–≤–ª–µ–Ω–æ:
```json
"permissions": ["alarms"]
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS —Ç–æ–ª—å–∫–æ
- Rate limiting –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- –í–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å API –∫–ª—é—á–∏ –¥–ª—è Chrome Web Store

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **328K** –∫–∞—Ä—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- **~33 –ú–ë** –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏ –ø–æ–ª–Ω–æ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏)
- **–ë–∞—Ç—á —Ä–∞–∑–º–µ—Ä**: 100 –∑–∞–ø–∏—Å–µ–π
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**: 30 –º–∏–Ω—É—Ç
- **–°—Ç–∞—Ä—Ç–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞**: ~5 –ú–±–∏—Ç/–º–µ—Å—è—Ü –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å backend
2. –ü–æ–ª—É—á–∏—Ç—å URL API
3. –û–±–Ω–æ–≤–∏—Ç—å `SYNC_SERVER_URL` –≤ config.js
4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ Chrome Web Store

---

**–°–æ–∑–¥–∞–Ω–æ: 27 –¥–µ–∫–∞–±—Ä—è 2025**
