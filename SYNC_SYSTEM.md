# MangaBuff Distributed Cache System v3.1

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¾ ĞºĞ°Ñ€Ñ‚Ğ°Ñ… MangaBuff.

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° v3.1 (Pull-only)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SCRAPER (Ğ²Ğ°Ñˆ ÑĞµÑ€Ğ²ĞµÑ€)                     â”‚
â”‚                    scraper-v2.js                            â”‚
â”‚   - ĞœĞ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ¾Ğ²                                      â”‚
â”‚   - Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾ĞºÑĞ¸ Ğ¸ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ñ‹                                â”‚
â”‚   - Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ² PostgreSQL                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Direct PostgreSQL INSERT
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚    Supabase     â”‚
                     â”‚   PostgreSQL    â”‚
                     â”‚  (cache_entries)â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ SELECT (read-only)
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             RENDER.COM BACKEND (server.js)                  â”‚
â”‚   - GET /sync/pull-all Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾                               â”‚
â”‚   - node-cache (5 Ğ¼Ğ¸Ğ½ TTL)                                  â”‚
â”‚   - GZIP ÑĞ¶Ğ°Ñ‚Ğ¸Ğµ                                             â”‚
â”‚   - Rate limit 50 req/hour                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ HTTP GET (Ğ¿Ñ€Ğ¸ ĞºĞ»Ğ¸ĞºĞµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸)
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Chrome Extension v3.1.0                        â”‚
â”‚   - ĞĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾-ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸                                  â”‚
â”‚   - Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ pull Ñ‡ĞµÑ€ĞµĞ· ĞºĞ½Ğ¾Ğ¿ĞºÑƒ                         â”‚
â”‚   - Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ Ğ² chrome.storage                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### ğŸ”„ Scraper (`scraper-v2.js`)
- ĞœĞ½Ğ¾Ğ³Ğ¾Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ ĞºĞ°Ñ€Ñ‚ Ñ MangaBuff
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ° Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ² Ğ¸ Ğ¿Ñ€Ğ¾ĞºÑĞ¸
- **ĞŸÑ€ÑĞ¼Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ğ² Supabase PostgreSQL** (Ğ±ĞµĞ· Render backend)
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½Ğ¸Ñ

### ğŸ–¥ï¸ Backend (`/backend/server.js`)
- Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚: `GET /sync/pull-all`
- node-cache Ñ TTL 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ (Ğ´ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
- GZIP ÑĞ¶Ğ°Ñ‚Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
- Rate limiting: 50 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²/Ñ‡Ğ°Ñ Ğ½Ğ° IP

### ğŸ“¦ Extension (`sync.js`)
- `syncPullAll()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ°
- Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ ĞºĞ»Ğ¸ĞºÑƒ Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ
- ĞĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

## ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Scraper â†’ Supabase (Ğ¿Ñ€ÑĞ¼Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ)
```javascript
// scraper-v2.js Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ pg Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ:
const { Pool } = require('pg');
pool.query(`
  INSERT INTO cache_entries (key, count, timestamp)
  VALUES ($1, $2, $3)
  ON CONFLICT (key) DO UPDATE ...
`)
```

### Extension â†’ Render.com â†’ Supabase (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ)
```javascript
// GET /sync/pull-all
// ĞÑ‚Ğ²ĞµÑ‚ (ĞºÑÑˆĞ¸Ñ€ÑƒĞµÑ‚ÑÑ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚):
{
  "entries": [
    { "key": "owners_123", "count": 100, "timestamp": 1766779000000 },
    { "key": "wishlist_123", "count": 50, "timestamp": 1766778000000 }
  ],
  "total": 2,
  "cached": true  // ĞµÑĞ»Ğ¸ Ğ¸Ğ· node-cache
}
```

## ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ v3.1

âœ… **ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚Ñ€Ğ°Ñ„Ğ¸Ğº Render** â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ, ĞºÑÑˆ 5 Ğ¼Ğ¸Ğ½  
âœ… **Ğ¡ĞºÑ€ĞµĞ¹Ğ¿ĞµÑ€ Ğ½Ğµ Ğ½Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ Render** â€” Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ Ğ² Supabase  
âœ… **ĞĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²** â€” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ€ĞµÑˆĞ°ĞµÑ‚ ĞºĞ¾Ğ³Ğ´Ğ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ  
âœ… **ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾** â€” extension Ğ½Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…  
âœ… **Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ½Ğ¾** â€” Render.com Free Tier (750h/Ğ¼ĞµÑ) Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾  

## Quick Start

### Ğ—Ğ°Ğ¿ÑƒÑĞº ÑĞºÑ€ĞµĞ¹Ğ¿ĞµÑ€Ğ°
```bash
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°
npm install puppeteer jsdom pg

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°
node scraper-v2.js --setup

# Ğ—Ğ°Ğ¿ÑƒÑĞº (1 Ğ²Ğ¾Ñ€ĞºĞµÑ€)
node scraper-v2.js

# Ğ—Ğ°Ğ¿ÑƒÑĞº (3 Ğ²Ğ¾Ñ€ĞºĞµÑ€Ğ°, ĞºĞ°Ñ€Ñ‚Ñ‹ 1-50000)
node scraper-v2.js --workers=3 --from=1 --to=50000
```

### Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ±ÑĞºĞµĞ½Ğ´Ğ°
```bash
cd backend
# Render.com auto-deploys from GitHub
# Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ: SUPABASE_URL Ğ¸ SUPABASE_KEY Ğ² Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ
# Ğ¡Ğ¼. backend/README-Render.md Ğ´Ğ»Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹
```

### Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ
```bash
npm run build
# Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ dist/ Ğ² Chrome ĞºĞ°Ğº unpacked extension
```

## Ğ¤Ğ°Ğ¹Ğ»Ñ‹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ’ Git? |
|------|----------|--------|
| `scraper-config.json` | URL Ğ‘Ğ”, Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ÑĞºÑ€ĞµĞ¹Ğ¿Ğ¸Ğ½Ğ³Ğ° | âŒ (ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ) |
| `scraper-accounts.json` | Cookies Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ¾Ğ² MangaBuff | âŒ |
| `scraper_progress.json` | ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ ÑĞºÑ€ĞµĞ¹Ğ¿Ğ¸Ğ½Ğ³Ğ° | âŒ |

## ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ

### Render.com Backend
```
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_KEY=eyJ...           # Anon/public key
NODE_ENV=production
PORT=3000                      # ĞŸĞ¾Ñ€Ñ‚ ÑĞµÑ€Ğ²ĞµÑ€Ğ° (Render Ğ·Ğ°Ğ´Ğ°Ñ‘Ñ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸)
```

### Scraper (scraper-config.json)
```json
{
  "database": {
    "url": "postgresql://postgres:PASSWORD@db.xxx.supabase.co:5432/postgres"
  }
}
```

## Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

| Ğ¡ĞµÑ€Ğ²Ğ¸Ñ | Tier | Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ |
|--------|------|-----------|
| Supabase PostgreSQL | Free | $0/Ğ¼ĞµÑ (500MB) |
| Render.com Backend | Free | $0/Ğ¼ĞµÑ (750h, Ñ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğ¼Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°Ğ¼Ğ¸) |
| Scraper | Ğ’Ğ°Ñˆ ÑĞµÑ€Ğ²ĞµÑ€ | â€” |

**Total: $0/Ğ¼ĞµÑÑÑ†** Ğ½Ğ° Free tier (Ñ Ñ…Ğ¾Ğ»Ğ¾Ğ´Ğ½Ñ‹Ğ¼Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğ°Ğ¼Ğ¸ 30-60Ñ Ğ¿Ğ¾ÑĞ»Ğµ Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸)
